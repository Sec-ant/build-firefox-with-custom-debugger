name: Build Firefox with Custom Debugger
on: workflow_dispatch
jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Show available disk space before build
        run: Get-PSDrive -PSProvider FileSystem
      - name: Create working directory
        run: md -p C:\workdir
      - name: Download MozillaBuild
        working-directory: C:\workdir
        run: Invoke-WebRequest -Uri "https://ftp.mozilla.org/pub/mozilla.org/mozilla/libraries/win32/MozillaBuildSetup-Latest.exe" -OutFile "./MozillaBuildSetup-Latest.exe"
      - name: Install MozillaBuild
        working-directory: C:\workdir
        run: ./MozillaBuildSetup-Latest.exe /NCRC /S
      - name: Start shell
        run: C:\mozilla-build\start-shell.bat
      - name: Bootstrap
        run: |
          cd c:/workdir
          mkdir mozilla-source
          cd mozilla-source
          wget https://hg.mozilla.org/mozilla-central/raw-file/default/python/mozboot/bin/bootstrap.py
          python3 bootstrap.py
        shell: C:\mozilla-build\start-shell.bat {0}
